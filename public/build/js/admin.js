function iniciarApp(){AddProducto(),ActualizarProducto(),verificarLogin(),editarTabla(),ObtenerProductoPorId(),ActualizarProductoModal(),EliminarProducto(),EstadoModal(),ActualizarColaboradorModal(),ActualizarColaborador(),ActualizarCategoriaModal(),ActualizarCategoria(),AddCategoria(),EliminarCategoria(),ActualizarMarcaModal(),AddMarca(),ActualizarMarca(),EliminarMarca(),AddColaborador(),UpdateStado(),getUsuario()}function verificarLogin(){$("#login").on("submit",(function(r){r.preventDefault();var e=$(this).serializeArray();$.ajax({type:$(this).attr("method"),data:e,url:"/login",dataType:"json",success:function(r){var e=r;"exito"==e.resultado&&(swal.fire({icon:"success",title:"Login Exitoso",text:"Bienvenido "+e.usuario,showConfirmButton:!1}),setTimeout((function(){window.location.href="/admin"}),600)),"error"==e.resultado&&swal.fire("Error","Password Incorrecto o Usuario No existente","error")},error:function(r){swal.fire("UPS!!!","Lo sentimos hubo un error inesperado","error")}})}))}function editarTabla(){$("#registro").DataTable({dom:"Bfrti",buttons:{dom:{button:{className:"btn"}},buttons:[{extend:"excel",text:"Generar Excel",className:"btn btn-outline-success ",excelStyles:{template:"blue_medium"}}]},paging:!0,lengthChange:!0,searching:!0,ordering:!1,info:!0,autoWidth:!1,pageLength:1e3,language:{info:"Mostrando del _START_ al _END_ de _TOTAL_ resultados",emptyaTable:"No hay registros",infoEmpty:"0 Registros",search:"Buscar",zeroRecords:"No se encontraron resultados",emptyTable:"Ningún dato disponible en esta tabla",lengthMenu:"Mostrar _MENU_ registros",paginate:{first:"Primero",last:"Último",next:"Siguiente",previous:"Anterior"}}})}function ObtenerProductoPorId(){$(".btnModal").on("click",(function(){var r=$(this).data("id");$.ajax({method:"POST",url:"/getInfo",data:{ventaId:r},success:function(r){var e=r;const t=JSON.parse(e);$(".del").remove();var o=$("#MyModaltable_header").find(".table tbody");t.ventas.forEach((function(r){o.append('<tr class="del"><td class="text-center">'+r.nombres+'</td><td class="text-center">'+r.apellidos+'</td><td class="text-center">'+r.telefono+'</td><td class="text-center">S/. '+r.total+"</td></tr>")}));var a=$("#MyModaltable").find(".table tbody");t.detalle.forEach((function(r){console.log(r.ventaId),a.append('<tr class="del"><td class="text-center">'+r.nombre+'</td><td class="text-center">'+r.categoria+'</td><td class="text-center">'+r.cantidad+'</td><td class="text-center">S/. '+r.precio+'</td><td class="text-center">S/. '+r.total+"</td></tr>")}))}})}))}function ActualizarProducto(){$("#editarProducto").on("submit",(function(r){r.preventDefault();var e=new FormData(this);$.ajax({type:"POST",data:e,url:"/editarProducto",dataType:"json",contentType:!1,processData:!1,async:!0,cache:!1,success:function(r){var e=r;"exito"==e.resultado&&(swal.fire("Exito","Actualizado correctamente ","success"),setTimeout((function(){window.location.href="/viewProducto"}),600)),"error"==e.resultado&&swal.fire("Error","Error al Actualizar","error")},error:function(r){swal.fire("UPS!!!","Lo sentimos hubo un error inesperado","error")}})}))}function AddProducto(){$("#addProducto").on("submit",(function(r){r.preventDefault();var e=new FormData(this);console.log(e),$.ajax({type:"POST",data:e,url:"/addProducto",dataType:"json",contentType:!1,processData:!1,async:!0,cache:!1,success:function(r){var e=r;if("exito"==e.resultado){Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:900}).fire({icon:"success",title:"Registrado Corectamente"}),setTimeout((function(){window.location.href="/viewProducto"}),900)}"error"==e.resultado&&swal.fire("Error","Error al agregar","error")},error:function(r){swal.fire("UPS!!!","Lo sentimos hubo un error inesperado","error")}})}))}function ActualizarProductoModal(){$(".editbtn").on("click",(function(r){$tr=$(this).closest("tr");var e=$tr.children("td").map((function(){return $(this).text()}));$cat=$(this).data("idcategoria"),$("#id").val(e[0]),$("#nombre").val(e[1]),$("#precio").val(e[2]),$("#idcategoria").text(e[3]),$("#idcategoria").val($cat),$("#stock").val(e[5])}))}function EliminarProducto(){$(".eliminartbtn").on("click",(function(r){r.preventDefault();var e=$(this).attr("data-id");console.log(e),swal.fire({title:"Estas seguro?",text:"Esta acción no se puede revertir!",type:"warning",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonText:"Si, Eliminar",cancelButtonText:"Cancelar"}).then(r=>{r.isConfirmed&&$.ajax({type:"POST",data:{id:e},url:"/eliminarProducto",dataType:"text",success:function(r){var e=JSON.parse(r);"exito"==e.resultado&&(swal.fire("Exito","Eliminado correctamente ","success"),jQuery("[data-id='"+e.id_eliminado+"'").parents("tr").remove()),"error"==e.resultado&&swal.fire("Error","No se pudo eliminar, intente denuevo","error")},error:function(r){swal.fire("UPS!!!","Lo sentimos hubo un error inesperado","error")}})})}))}function ActualizarCategoriaModal(){$(".editbtnCategoria").on("click",(function(r){$tr=$(this).closest("tr");var e=$tr.children("td").map((function(){return $(this).text()}));$("#id").val(e[0]),$("#nombre").val(e[1]),$("#descripcion").val(e[2])}))}function ActualizarCategoria(){$("#editarCategoria").on("submit",(function(r){r.preventDefault();var e=$(this).serializeArray();$.ajax({type:"POST",data:e,url:"/addEditarCategoria",dataType:"json",success:function(r){var e=r;"exito"==e.resultado&&(swal.fire("Exito","Actualizado correctamente ","success"),setTimeout((function(){window.location.href="/viewCategorias"}),600)),"error"==e.resultado&&swal.fire("Error","Error al Actualizar","error")},error:function(r){swal.fire("UPS!!!","Lo sentimos hubo un error inesperado","error")}})}))}function AddCategoria(){$("#addcategoria").on("submit",(function(r){r.preventDefault();var e=$(this).serializeArray();console.log(e),$.ajax({type:"POST",data:e,url:"/addEditarCategoria",dataType:"json",success:function(r){var e=r;"exito"==e.resultado&&(swal.fire("Registro Exitoso","","success"),setTimeout((function(){window.location.href="/viewCategorias"}),900)),"alerta"==e.resultado&&swal.fire("Advertencia!!!","Ya existe un usuario con ese correo","warning"),"error"==e.resultado&&swal.fire("Error","Error al agregar","error")},error:function(r){swal.fire("UPS!!!","Lo sentimos hubo un error inesperado","error")}})}))}function EliminarCategoria(){$(".eliminartbtnCategoria").on("click",(function(r){r.preventDefault();var e=$(this).attr("data-id");console.log(e),swal.fire({title:"Estas seguro?",text:"Esta acción no se puede revertir!",type:"warning",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonText:"Si, Eliminar",cancelButtonText:"Cancelar"}).then(r=>{r.isConfirmed&&$.ajax({type:"POST",data:{id:e},url:"/eliminarCategoria",dataType:"text",success:function(r){var e=JSON.parse(r);"exito"==e.resultado&&(swal.fire("Exito","Eliminado correctamente ","success"),jQuery("[data-id='"+e.id_eliminado+"'").parents("tr").remove()),"error"==e.resultado&&swal.fire("Error","No se pudo eliminar, intente denuevo","error")},error:function(r){swal.fire("UPS!!!","Lo sentimos hubo un error inesperado","error")}})})}))}function ActualizarColaborador(){$("#editarColaborador").on("submit",(function(r){r.preventDefault();var e=$(this).serializeArray();$.ajax({type:"POST",data:e,url:"/addEditarColaborador",dataType:"json",success:function(r){var e=r;"exito"==e.resultado&&(swal.fire("Exito","Actualizado correctamente ","success"),setTimeout((function(){window.location.href="/viewColaborador"}),600)),"error"==e.resultado&&swal.fire("Error","Error al Actualizar","error")},error:function(r){swal.fire("UPS!!!","Lo sentimos hubo un error inesperado","error")}})}))}function ActualizarMarcaModal(){$(".editbtnMarca").on("click",(function(r){$tr=$(this).closest("tr");var e=$tr.children("td").map((function(){return $(this).text()}));$("#id").val(e[0]),$("#nombre").val(e[1]),$("#descripcion").val(e[2])}))}function ActualizarMarca(){$("#editarMarca").on("submit",(function(r){r.preventDefault();var e=$(this).serializeArray();$.ajax({type:"POST",data:e,url:"/addEditarMarca",dataType:"json",success:function(r){var e=r;"exito"==e.resultado&&(swal.fire("Exito","Actualizado correctamente ","success"),setTimeout((function(){window.location.href="/viewMarcas"}),600)),"error"==e.resultado&&swal.fire("Error","Error al Actualizar","error")},error:function(r){swal.fire("UPS!!!","Lo sentimos hubo un error inesperado","error")}})}))}function AddMarca(){$("#addMarca").on("submit",(function(r){r.preventDefault();var e=$(this).serializeArray();console.log(e),$.ajax({type:"POST",data:e,url:"/addEditarMarca",dataType:"json",success:function(r){var e=r;"exito"==e.resultado&&(swal.fire("Registro Exitoso","","success"),setTimeout((function(){window.location.href="/viewMarcas"}),900)),"alerta"==e.resultado&&swal.fire("Advertencia!!!","No se puede registrar","warning"),"error"==e.resultado&&swal.fire("Error","Error al agregar","error")},error:function(r){swal.fire("UPS!!!","Lo sentimos hubo un error inesperado","error")}})}))}function EliminarMarca(){$(".eliminartbtnMarca").on("click",(function(r){r.preventDefault();var e=$(this).attr("data-id");swal.fire({title:"Estas seguro?",text:"Esta acción no se puede revertir!",type:"warning",showCancelButton:!0,cancelButtonColor:"#d33",confirmButtonText:"Si, Eliminar",cancelButtonText:"Cancelar"}).then(r=>{r.isConfirmed&&$.ajax({type:"POST",data:{id:e},url:"/eliminarMarca",dataType:"text",success:function(r){var e=JSON.parse(r);"exito"==e.resultado&&(swal.fire("Exito","Eliminado correctamente ","success"),jQuery("[data-id='"+e.id_eliminado+"'").parents("tr").remove()),"error"==e.resultado&&swal.fire("Error","No se pudo eliminar, intente denuevo","error")},error:function(r){swal.fire("UPS!!!","Lo sentimos hubo un error inesperado","error")}})})}))}function AddColaborador(){$("#addColaborador").on("submit",(function(r){r.preventDefault();var e=$(this).serializeArray();console.log(e),$.ajax({type:"POST",data:e,url:"/crear-usuario",dataType:"json",success:function(r){var e=r;"exito"==e.resultado&&(swal.fire("Registro Exitoso","Bienvenido","success"),setTimeout((function(){window.location.href="/viewColaborador"}),900)),"alerta"==e.resultado&&swal.fire("Advertencia!!!","Ya existe un usuario con ese correo","warning"),"error"==e.resultado&&swal.fire("Error","Error al agregar","error")},error:function(r){swal.fire("UPS!!!","Lo sentimos hubo un error inesperado","error")}})}))}function ActualizarColaboradorModal(){$(".editColaboradorbtn").on("click",(function(r){$tr=$(this).closest("tr");var e=$tr.children("td").map((function(){return $(this).text()}));console.log(e),$("#id").val(e[0]),$("#nombre").val(e[1]),$("#apellido").val(e[2]),$("#email").val(e[3]),$("#telefono").val(e[4])}))}function nuevoMostrarDatosUserModal(){$(".editColaboradorbtn").on("click",(function(r){r.preventDefault(),$tr=$(this).closest("tr");var e=$tr.children("td").map((function(){return $(this).text()}));$email=e[3],console.log($email),$.ajax({type:"POST",data:$email,url:"/getInfoUser",dataType:"json",success:function(r){},error:function(r){swal.fire("UPS!!!","Lo sentimos hubo un error inesperado","error")}})}))}function getUsuario(){$("#editarCuenta").on("submit",(function(r){r.preventDefault();var e=$(this).serializeArray();console.log(e),$.ajax({type:"POST",data:e,url:"/cuenta",dataType:"json",success:function(r){var e=r;"exito"==e.resultado&&(swal.fire("Registro Exitoso","Actualizado Correctamente","success"),setTimeout((function(){window.location.href="/viewProducto"}),900)),"alerta"==e.resultado&&swal.fire("Error!!!","La contraseña actual no es correcta","warning"),"error"==e.resultado&&swal.fire("Error","Error al agregar","error")},error:function(r){swal.fire("UPS!!!","Lo sentimos hubo un error inesperado","error")}})}))}function report(){$("#report").on("submit",(function(r){r.preventDefault();var e=$(this).serializeArray();console.log(e),$.ajax({type:"POST",data:e,url:"/report",dataType:"json",success:function(r){},error:function(r){swal.fire("UPS!!!","Lo sentimos hubo un error inesperado","error")}})}))}function EstadoModal(){$(".btnModalEstado").on("click",(function(r){$id=$(this).data("id"),console.log($id),$("#id").val($id)}))}function UpdateStado(){$("#updateEstado").on("submit",(function(r){r.preventDefault();var e=$(this).serializeArray();console.log(e),$.ajax({type:"POST",data:e,url:"/updateEstado",dataType:"json",success:function(r){var e=r;if("exito"==e.resultado){Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:900}).fire({icon:"success",title:"Estado actualizado"}),setTimeout((function(){window.location.href="/admin"}),900)}"alerta"==e.resultado&&swal.fire("Advertencia!!!","Ya existe un usuario con ese correo","warning"),"error"==e.resultado&&swal.fire("Error","Error al agregar","error")},error:function(r){swal.fire("UPS!!!","Lo sentimos hubo un error inesperado","error")}})}))}function ValidateInput(r){for(i in r)""==r[i].value?$("#nombre").addClass("is-invalid"):console.log("nombre lleno")}document.addEventListener("DOMContentLoaded",(function(){iniciarApp()}));