!function(t){"use strict";var a,o,e=(o={classCartIcon:"my-cart-icon",classCartBadge:"my-cart-badge",classProductQuantity:"my-product-quantity",classProductRemove:"my-product-remove",classCheckoutCart:"my-cart-checkout",affixCartIcon:!0,showCheckoutModal:!0,clickOnAddToCart:function(t){},clickOnCartIcon:function(t,a,o,e){},checkoutCart:function(t,a,o){},getDiscountPrice:function(t,a,o){return null}},(a={}).getOptions=function(a){var e=t.extend({},o);return"object"==typeof a&&t.extend(e,a),e},a),r=function(){var a={};localStorage.products=localStorage.products?localStorage.products:"";var o=function(t){localStorage.products=JSON.stringify(t)},e=function(){try{return JSON.parse(localStorage.products)}catch(t){return[]}},r=function(a,r){var c=function(a){var o=-1,r=e();return t.each(r,(function(t,e){e.id!=a||(o=t)})),o}(a);if(c<0)return!1;var i=e();return i[c].quantity=void 0===r?1*i[c].quantity+1:r,o(i),!0};return a.getAllProducts=e,a.updatePoduct=r,a.setProduct=function(a,c,i,n,d,s){return void 0===a?(console.error("id required"),!1):void 0===c?(console.error("name required"),!1):void 0===s?(console.error("image required"),!1):t.isNumeric(n)?t.isNumeric(d)?(i=void 0===i?"":i,void(r(a)||function(t,a,r,c,i,n){var d=e();d.push({id:t,name:a,summary:r,price:c,quantity:i,image:n}),o(d)}(a,c,i,n,d,s))):(console.error("quantity is not a number"),!1):(console.error("price is not a number"),!1)},a.clearProduct=function(){o([])},a.removeProduct=function(a){var r=e();r=t.grep(r,(function(t,o){return t.id!=a})),o(r)},a.getTotalQuantity=function(){var a=0,o=e();return t.each(o,(function(t,o){a+=1*o.quantity})),a},a.getTotalPrice=function(){var a=e(),o=0;return t.each(a,(function(t,a){o+=a.quantity*a.price})),o},a}(),c=function(a){var o=e.getOptions(a),c=t("."+o.classCartIcon),i=t("."+o.classCartBadge),n=o.classProductQuantity,d=o.classProductRemove,s=o.classCheckoutCart;i.text(r.getTotalQuantity()),t("#my-cart-modal").length||t("body").append('<div class="modal fade" id="my-cart-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="myModalLabel"><span class="glyphicon glyphicon-shopping-cart"></span> My Cart</h4></div><div class="modal-body"><table class="table table-hover table-responsive" id="my-cart-table"></table></div><div class="modal-footer agregado" id="agregado"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button><button class="comprar" >Comprar</button></div></div></div></div>');var l=function(){var a=t("#my-cart-table");a.empty();var e=r.getAllProducts();t.each(e,(function(){var t=this.quantity*this.price;a.append('<tr title="'+this.summary+'" data-id="'+this.id+'" data-price="'+this.price+'"><td class="text-center" style="width: 30px;"><img width="30px" height="30px" src="/build/'+this.image+'"/></td><td>'+this.name+'</td><td title="Unit Price">$'+this.price+'</td><td title="Quantity"><input type="number" min="1" style="width: 70px;" class="'+n+'" value="'+this.quantity+'"/></td><td title="Total" class="my-product-total">$'+t+'</td><td title="Remove from Cart" class="text-center" style="width: 30px;"><a href="javascript:void(0);" class="btn btn-xs btn-danger '+d+'">X</a></td></tr>')})),a.append(e.length?'<tr><td></td><td><strong>Total</strong></td><td></td><td></td><td><strong id="my-cart-grand-total">$</strong></td><td></td></tr>':'<div class="alert alert-danger" role="alert" id="my-cart-empty-message">Your cart is empty</div>');var c=o.getDiscountPrice(e,r.getTotalPrice(),r.getTotalQuantity());e.length&&null!==c&&a.append('<tr style="color: red"><td></td><td><strong>Total (including discount)</strong></td><td></td><td></td><td><strong id="my-cart-discount-price">$</strong></td><td></td></tr>'),u(),m()},u=function(){t("#my-cart-grand-total").text("$"+r.getTotalPrice())},m=function(){t("#my-cart-discount-price").text("$"+o.getDiscountPrice(r.getAllProducts(),r.getTotalPrice(),r.getTotalQuantity()))};if(o.affixCartIcon){var g=1*c.offset().top+1*c.css("height").match(/\d+/),p=c.css("position");t(window).scroll((function(){t(window).scrollTop()>=g?c.css("position","fixed").css("z-index","999").addClass("my-cart-icon-affix"):c.css("position",p).css("background-color","inherit").removeClass("my-cart-icon-affix")}))}c.click((function(){o.showCheckoutModal?(l(),t("#my-cart-modal").modal("show")):o.clickOnCartIcon(c,r.getAllProducts(),r.getTotalPrice(),r.getTotalQuantity())})),t(document).on("input","."+n,(function(){var a=t(this).closest("tr").data("price"),o=t(this).closest("tr").data("id"),e=t(this).val();t(this).parent("td").next(".my-product-total").text("$"+a*e),r.updatePoduct(o,e),i.text(r.getTotalQuantity()),u(),m()})),t(document).on("keypress","."+n,(function(t){38!=t.keyCode&&40!=t.keyCode&&t.preventDefault()})),t(document).on("click","."+d,(function(){var a=t(this).closest("tr"),o=a.data("id");a.hide(500,(function(){r.removeProduct(o),l(),i.text(r.getTotalQuantity())}))})),t("."+s).click((function(){r.getAllProducts().length?(t.each(t("."+n),(function(){var a=t(this).closest("tr").data("id");r.updatePoduct(a,t(this).val())})),o.checkoutCart(r.getAllProducts(),r.getTotalPrice(),r.getTotalQuantity()),r.clearProduct(),i.text(r.getTotalQuantity()),t("#my-cart-modal").modal("hide")):t("#my-cart-empty-message").fadeTo("fast",.5).fadeTo("fast",1)})),t(".comprar").click((function(){r.getAllProducts();var a=localStorage.products;t.ajax({url:"/cart/",type:"POST",dataType:"json",data:{json:a},success:function(t){window.location.href="/cart/"}})}))},i=function(a,o){var c=t(a),i=e.getOptions(o),n=(t("."+i.classCartIcon),t("."+i.classCartBadge));c.click((function(){i.clickOnAddToCart(c);var t=c.data("id"),a=c.data("name"),o=c.data("summary"),e=c.data("price"),d=c.data("quantity"),s=c.data("image");r.setProduct(t,a,o,e,d,s),n.text(r.getTotalQuantity())}))};t.fn.myCart=function(a){return c(a),t.each(this,(function(){new i(this,a)}))}}(jQuery);